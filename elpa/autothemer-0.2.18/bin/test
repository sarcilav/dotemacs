#!/bin/sh
dash="$(dirname "$(find ~/.emacs.d | grep "/dash.el$" | tail -1)")"

EMACS="${EMACS:=emacs}"

cat <<INFO
════════════════════════════════════════════════════════════════════════════════
    _         _      _____ _
   / \  _   _| |_ __|_   _| |__   ___ _ __ ___   ___ _ __
  / _ \| | | | __/ _ \| | | '_ \ / _ \ '_ ' _ \ / _ \ '__|
 / ___ \ |_| | || (_) | | | | | |  __/ | | | | |  __/ |
/_/   \_\__,_|\__\___/|_| |_| |_|\___|_| |_| |_|\___|_|
 _____         _
|_   _|__  ___| |_ ___
  | |/ _ \/ __| __/ __|
  | |  __/\__ \ |_\__ \\
  |_|\___||___/\__|___/

────────────────────────────────────────────────────────────────────────────────
Required packages present:
Dash: $dash
════════════════════════════════════════════════════════════════════════════════
$("$EMACS" --version)
════════════════════════════════════════════════════════════════════════════════
INFO

"$EMACS" --batch \
  -eval "(setq load-prefer-newer t)" \
  -eval "(add-to-list 'load-path \"${dash}\")" \
  -eval "(add-to-list 'load-path \".\")" \
  -l ert \
  -l dash \
  -l autothemer.el \
  -l tests/autothemer-tests.el \
  -f ert-run-tests-batch-and-exit
exitcode=$?

echo "
════════════════════════════════════════════════════════════════════════════════"
exit ${exitcode}
